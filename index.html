<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>빛의 굴절</title>
  <style>
    body {
      margin: 0;
      font-family: Malgun Gothic, sans-serif;
    }

    canvas {
      display: block;
    }

    .info {
      position: absolute;
      left: 20px;
      bottom: 20px;
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
    }

    .info h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }

    .panel {
      position: absolute;
      right: 20px;
      top: 20px;
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 8px;
    }

    .panel button {
      width: 120px;
      padding: 10px;
      margin: 5px 0;
      font-size: 14px;
      cursor: pointer;
      border: 2px solid #aaa;
      border-radius: 6px;
      background-color: #eee;
    }

    .panel button.active {
      border-color: #333;
      font-weight: bold;
    }

    .author {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 13px;
      background: rgba(255,255,255,0.8);
      padding: 6px 10px;
      border-radius: 5px;
    }
  </style>
</head>

<body>

  <div class="author">제작: 2514 윤채령, 2515 이유진</div>

  <div class="panel">
    <div>매질 선택</div>
    <button data-type="water" class="active">물</button>
    <button data-type="glass">유리</button>
    <button data-type="diamond">다이아몬드</button>
  </div>

  <div class="info">
    <h3>각도 정보</h3>
    <div>입사각: <span id="inAngle">0°</span></div>
    <div>굴절각: <span id="reAngle">0°</span></div>
    <div>공기 굴절률: 1.00</div>
    <div>매질 굴절률: <span id="nValue">1.33</span></div>
  </div>

  <canvas id="cv"></canvas>

  <script>
    const canvas = document.getElementById("cv");
    const ctx = canvas.getContext("2d");

    function setSize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    setSize();
    window.addEventListener("resize", setSize);

    const mediumData = {
      water: { n: 1.33, color: "#7ec8ff", name: "물" },
      glass: { n: 1.52, color: "#f0e68c", name: "유리" },
      diamond: { n: 2.42, color: "#dff", name: "다이아몬드" }
    };

    let currentMedium = "water";
    let mouseX = canvas.width / 2;
    let mouseY = 100;

    document.querySelectorAll(".panel button").forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll(".panel button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentMedium = btn.dataset.type;
        document.getElementById("nValue").innerText = mediumData[currentMedium].n;
        draw();
      };
    });

    canvas.addEventListener("mousemove", e => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      draw();
    });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const mid = canvas.height / 2;

      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, canvas.width, mid);

      ctx.fillStyle = mediumData[currentMedium].color;
      ctx.fillRect(0, mid, canvas.width, mid);

      ctx.strokeStyle = "#333";
      ctx.setLineDash([10, 6]);
      ctx.beginPath();
      ctx.moveTo(0, mid);
      ctx.lineTo(canvas.width, mid);
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, mid - 120);
      ctx.lineTo(canvas.width / 2, mid + 120);
      ctx.strokeStyle = "#666";
      ctx.setLineDash([6, 4]);
      ctx.stroke();
      ctx.setLineDash([]);

      if (mouseY < mid) {
        calcRefraction(mouseX, mouseY, mid);
      } else {
        updateText(0, 0);
      }

      ctx.fillStyle = "#000";
      ctx.fillText("공기", 20, mid - 20);
      ctx.fillText(mediumData[currentMedium].name, 20, mid + 30);
    }

    function calcRefraction(x, y, baseY) {
      const cx = canvas.width / 2;
      const cy = baseY;

      const dx = cx - x;
      const dy = cy - y;

      const angle1 = Math.atan2(Math.abs(dx), Math.abs(dy));
      const n1 = 1;
      const n2 = mediumData[currentMedium].n;

      const sinVal = (n1 / n2) * Math.sin(angle1);

      drawLine(x, y, cx, cy, "red");

      if (sinVal > 1) {
        updateText(radToDeg(angle1), "전반사");
        return;
      }

      const angle2 = Math.asin(sinVal);
      const dir = dx > 0 ? 1 : -1;

      drawLine(cx, cy, cx + dir * Math.tan(angle2) * 500, canvas.height, "orange");

      updateText(radToDeg(angle1), radToDeg(angle2));
    }

    function drawLine(x1, y1, x2, y2, color) {
      ctx.strokeStyle = color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();
    }

    function updateText(a, b) {
      document.getElementById("inAngle").innerText =
        typeof a === "number" ? a.toFixed(1) + "°" : a;
      document.getElementById("reAngle").innerText =
        typeof b === "number" ? b.toFixed(1) + "°" : b;
    }

    function radToDeg(r) {
      return r * 180 / Math.PI;
    }

    draw();
  </script>
</body>
</html>
