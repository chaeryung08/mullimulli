<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- ë¬¸ì ì¸ì½”ë”© ì„¤ì •: í•œê¸€ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ UTF-8 ì‚¬ìš© -->
  <meta charset="UTF-8">
  
  <!-- ë°˜ì‘í˜• ì›¹ì„ ìœ„í•œ ë·°í¬íŠ¸ ì„¤ì • -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ë¸Œë¼ìš°ì € íƒ­ì— í‘œì‹œë  ì œëª© -->
  <title>ë¹›ì˜ êµ´ì ˆ ì‹œë®¬ë ˆì´ì…˜</title>
  
  <!-- ì™¸ë¶€ CSS íŒŒì¼ ì—°ê²° -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ë§¤ì§ˆ ì„ íƒ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
  <div class="button-container">
    <!-- ì œëª© -->
    <h2>ë§¤ì§ˆì„ ì„ íƒí•˜ì„¸ìš”</h2>
    
    <!-- ë‹¤ì´ì•„ëª¬ë“œ ì„ íƒ ë²„íŠ¼ -->
    <button class="medium-btn dia-btn" onclick="changeMedium('dia')">ë‹¤ì´ì•„ëª¬ë“œ</button>
    
    <!-- ë¬¼ ì„ íƒ ë²„íŠ¼ (ê¸°ë³¸ ì„ íƒ) -->
    <button class="medium-btn wat-btn active" onclick="changeMedium('wat')">ë¬¼</button>
    
    <!-- ìœ ë¦¬ ì„ íƒ ë²„íŠ¼ -->
    <button class="medium-btn gla-btn" onclick="changeMedium('gla')">ìœ ë¦¬</button>
  </div>

  <!-- êµ´ì ˆ ì •ë³´ë¥¼ í‘œì‹œí•˜ëŠ” ë°•ìŠ¤ (ì˜¤ë¥¸ìª½ ìƒë‹¨) -->
  <div class="info-box">
    <h3>ğŸ“Š êµ´ì ˆ ì •ë³´</h3>
    
    <!-- ì…ì‚¬ê° í‘œì‹œ -->
    <div class="info-item">ì…ì‚¬ê°: <span class="info-value" id="incidentAngle">0Â°</span></div>
    
    <!-- êµ´ì ˆê° í‘œì‹œ -->
    <div class="info-item">êµ´ì ˆê°: <span class="info-value" id="refractedAngle">0Â°</span></div>
    
    <!-- ê³µê¸°ì˜ êµ´ì ˆë¥  (ê³ ì •ê°’) -->
    <div class="info-item">ê³µê¸° êµ´ì ˆë¥ : <span class="info-value">1.00</span></div>
    
    <!-- í˜„ì¬ ì„ íƒëœ ë§¤ì§ˆì˜ êµ´ì ˆë¥  -->
    <div class="info-item">ë§¤ì§ˆ êµ´ì ˆë¥ : <span class="info-value" id="mediumIndex">1.33</span></div>
  </div>

  <!-- ê·¸ë¦¼ì„ ê·¸ë¦´ ìº”ë²„ìŠ¤ -->
  <canvas id="canva"></canvas>

  <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì‹œì‘ -->
  <script>
    // ===== ìº”ë²„ìŠ¤ ì´ˆê¸° ì„¤ì • =====
    // ìº”ë²„ìŠ¤ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const canva = document.getElementById('canva');
    
    // 2D ê·¸ë¦¬ê¸° ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    const ctx = canva.getContext('2d');
    
    // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ë¸Œë¼ìš°ì € ì°½ í¬ê¸°ì— ë§ì¶”ê¸°
    canva.width = window.innerWidth;   // ë„ˆë¹„
    canva.height = window.innerHeight; // ë†’ì´

    // ===== ë§¤ì§ˆë³„ ì†ì„± ì •ì˜ =====
    const mediums = {
      // ë‹¤ì´ì•„ëª¬ë“œ ì†ì„±
      dia: { 
        name: 'ë‹¤ì´ì•„ëª¬ë“œ',           // ë§¤ì§ˆ ì´ë¦„
        refractiveIndex: 2.42,        // êµ´ì ˆë¥  (ë¹›ì´ ì–¼ë§ˆë‚˜ êº¾ì´ëŠ”ì§€)
        color: '#e0ffff'              // ë°°ê²½ìƒ‰ (ì—°í•œ ì²­ë¡ìƒ‰)
      },
      // ë¬¼ ì†ì„±
      wat: { 
        name: 'ë¬¼', 
        refractiveIndex: 1.33,        // ë¬¼ì˜ êµ´ì ˆë¥ 
        color: '#4facfe'              // ë°°ê²½ìƒ‰ (íŒŒë€ìƒ‰)
      },
      // ìœ ë¦¬ ì†ì„±
      gla: { 
        name: 'ìœ ë¦¬', 
        refractiveIndex: 1.52,        // ìœ ë¦¬ì˜ êµ´ì ˆë¥ 
        color: '#fafad2'              // ë°°ê²½ìƒ‰ (ì—°í•œ ë…¸ë€ìƒ‰)
      }
    };

    // ===== ì „ì—­ ë³€ìˆ˜ =====
    let currentMedium = 'wat';        // í˜„ì¬ ì„ íƒëœ ë§¤ì§ˆ (ê¸°ë³¸ê°’: ë¬¼)
    let mouseX = canva.width / 2;     // ë§ˆìš°ìŠ¤ X ì¢Œí‘œ (ì´ˆê¸°ê°’: í™”ë©´ ì¤‘ì•™)
    let mouseY = 100;                 // ë§ˆìš°ìŠ¤ Y ì¢Œí‘œ (ì´ˆê¸°ê°’: ìœ„ìª½)

    // ===== ë§¤ì§ˆ ë³€ê²½ í•¨ìˆ˜ =====
    function changeMedium(medium) {
      // ì„ íƒëœ ë§¤ì§ˆë¡œ ë³€ê²½
      currentMedium = medium;
      
      // ëª¨ë“  ë²„íŠ¼ì—ì„œ 'active' í´ë˜ìŠ¤ ì œê±° (ì„ íƒ í‘œì‹œ ì œê±°)
      document.querySelectorAll('.medium-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // í´ë¦­ëœ ë²„íŠ¼ì— 'active' í´ë˜ìŠ¤ ì¶”ê°€ (ì„ íƒ í‘œì‹œ)
      event.target.classList.add('active');
      
      // ì˜¤ë¥¸ìª½ ì •ë³´ ë°•ìŠ¤ì˜ êµ´ì ˆë¥  ì—…ë°ì´íŠ¸
      document.getElementById('mediumIndex').textContent = mediums[medium].refractiveIndex;
      
      // í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      draw();
    }

    // ===== ë§ˆìš°ìŠ¤ ì›€ì§ì„ ê°ì§€ =====
    // ë§ˆìš°ìŠ¤ê°€ ì›€ì§ì¼ ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    canva.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;  // ë§ˆìš°ìŠ¤ X ì¢Œí‘œ ì—…ë°ì´íŠ¸
      mouseY = e.clientY;  // ë§ˆìš°ìŠ¤ Y ì¢Œí‘œ ì—…ë°ì´íŠ¸
      draw();              // í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    });

    // ===== ë©”ì¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜ =====
    function draw() {
      // ìº”ë²„ìŠ¤ ì „ì²´ë¥¼ ì§€ì›Œì„œ ì´ˆê¸°í™”
      ctx.clearRect(0, 0, canva.width, canva.height);

      // í™”ë©´ì„ ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²½ê³„ì„  Y ì¢Œí‘œ
      const middleY = canva.height / 2;

      // ----- ìœ„ìª½ ì ˆë°˜: ê³µê¸° ì˜ì—­ ê·¸ë¦¬ê¸° -----
      ctx.fillStyle = '#ffffff';  // í°ìƒ‰
      ctx.fillRect(0, 0, canva.width, middleY);

      // ----- ì•„ë˜ìª½ ì ˆë°˜: ë§¤ì§ˆ ì˜ì—­ ê·¸ë¦¬ê¸° -----
      ctx.fillStyle = mediums[currentMedium].color;  // ì„ íƒëœ ë§¤ì§ˆì˜ ìƒ‰ìƒ
      ctx.fillRect(0, middleY, canva.width, canva.height - middleY);

      // ----- ê²½ê³„ì„  ê·¸ë¦¬ê¸° -----
      ctx.strokeStyle = '#333';      // ì§„í•œ íšŒìƒ‰
      ctx.lineWidth = 3;             // ì„  ë‘ê»˜
      ctx.setLineDash([15, 8]);      // ì ì„  íŒ¨í„´ (15px ê·¸ë¦¬ê³  8px ë¹„ìš°ê¸°)
      ctx.beginPath();
      ctx.moveTo(0, middleY);        // ì‹œì‘ì  (ì™¼ìª½ ë)
      ctx.lineTo(canva.width, middleY);  // ëì  (ì˜¤ë¥¸ìª½ ë)
      ctx.stroke();                  // ì„  ê·¸ë¦¬ê¸°
      ctx.setLineDash([]);           // ì ì„  íŒ¨í„´ í•´ì œ

      // ----- ë§¤ì§ˆ ì •ë³´ í…ìŠ¤íŠ¸ í‘œì‹œ -----
      ctx.fillStyle = '#333';        // ê¸€ììƒ‰
      ctx.font = 'bold 20px Malgun Gothic';  // ê¸€ê¼´
      
      // ê³µê¸° ì •ë³´ (ìœ„ìª½)
      ctx.fillText('ê³µê¸° (n=1.00)', 30, middleY - 30);
      
      // ë§¤ì§ˆ ì •ë³´ (ì•„ë˜ìª½)
      ctx.fillText(
        `${mediums[currentMedium].name} (n=${mediums[currentMedium].refractiveIndex})`, 
        30, 
        middleY + 50
      );

      // ----- êµ´ì ˆ ê·¸ë¦¬ê¸° -----
      // ë§ˆìš°ìŠ¤(ê´‘ì›)ê°€ ê³µê¸° ì˜ì—­ì— ìˆì„ ë•Œë§Œ êµ´ì ˆ ê·¸ë¦¬ê¸°
      if (mouseY < middleY) {
        drawRefraction(mouseX, mouseY, middleY);
      } else {
        // ê´‘ì›ì´ ë§¤ì§ˆ ì•ˆì— ìˆìœ¼ë©´ ê°ë„ ì •ë³´ ì´ˆê¸°í™”
        document.getElementById('incidentAngle').textContent = '0Â°';
        document.getElementById('refractedAngle').textContent = '0Â°';
      }

      // ----- ê´‘ì›(ë§ˆìš°ìŠ¤ ìœ„ì¹˜) í‘œì‹œ -----
      drawLightSource(mouseX, mouseY);
    }

    // ===== êµ´ì ˆ ê³„ì‚° ë° ê·¸ë¦¬ê¸° í•¨ìˆ˜ =====
    function drawRefraction(lightX, lightY, boundaryY) {
      // ë¹›ì´ ê²½ê³„ì„ ê³¼ ë§Œë‚˜ëŠ” ì  (í™”ë©´ ì¤‘ì•™)
      const intersectionX = canva.width / 2;
      const intersectionY = boundaryY;

      // ----- ì…ì‚¬ ê´‘ì„  ê³„ì‚° -----
      // ê´‘ì›ì—ì„œ ê²½ê³„ì„  êµì ê¹Œì§€ì˜ ë²¡í„°
      const dx1 = intersectionX - lightX;  // X ë°©í–¥ ê±°ë¦¬
      const dy1 = intersectionY - lightY;  // Y ë°©í–¥ ê±°ë¦¬

      // ì…ì‚¬ê° ê³„ì‚° (ë²•ì„ ê³¼ì˜ ê°ë„)
      // Math.atan2: ë‘ ì  ì‚¬ì´ì˜ ê°ë„ë¥¼ ë¼ë””ì•ˆìœ¼ë¡œ ë°˜í™˜
      const incidentAngleRad = Math.atan2(Math.abs(dx1), Math.abs(dy1));
      const incidentAngleDeg = (incidentAngleRad * 180 / Math.PI).toFixed(1);  // ë„(Â°)ë¡œ ë³€í™˜

      // ----- ìŠ¤ë„¬ì˜ ë²•ì¹™ì„ ì´ìš©í•œ êµ´ì ˆê° ê³„ì‚° -----
      // ìŠ¤ë„¬ì˜ ë²•ì¹™: n1 * sin(Î¸1) = n2 * sin(Î¸2)
      const n1 = 1.0;  // ê³µê¸°ì˜ êµ´ì ˆë¥ 
      const n2 = mediums[currentMedium].refractiveIndex;  // ë§¤ì§ˆì˜ êµ´ì ˆë¥ 
      
      // sin(êµ´ì ˆê°) ê³„ì‚°
      const sinRefracted = (n1 / n2) * Math.sin(incidentAngleRad);
      
      // ì „ë°˜ì‚¬ ì²´í¬: sin ê°’ì´ 1ë³´ë‹¤ í¬ë©´ ì „ë°˜ì‚¬ ë°œìƒ
      if (sinRefracted > 1) {
        // ì „ë°˜ì‚¬ì¼ ê²½ìš° ì…ì‚¬ ê´‘ì„ ë§Œ ê·¸ë¦¬ê¸°
        drawIncidentRay(lightX, lightY, intersectionX, intersectionY);
        
        // ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById('incidentAngle').textContent = incidentAngleDeg + 'Â°';
        document.getElementById('refractedAngle').textContent = 'ì „ë°˜ì‚¬';
        return;
      }

      // êµ´ì ˆê° ê³„ì‚° (ë¼ë””ì•ˆ)
      const refractedAngleRad = Math.asin(sinRefracted);
      const refractedAngleDeg = (refractedAngleRad * 180 / Math.PI).toFixed(1);  // ë„(Â°)ë¡œ ë³€í™˜

      // ----- êµ´ì ˆ ê´‘ì„ ì˜ ëì  ê³„ì‚° -----
      // êµ´ì ˆ ê´‘ì„ ì´ í™”ë©´ ì•„ë˜ìª½ìœ¼ë¡œ ì§„í–‰
      const refractedLength = canva.height - intersectionY;  // êµ´ì ˆ ê´‘ì„  ê¸¸ì´
      
      // X ë°©í–¥ìœ¼ë¡œ ì–¼ë§ˆë‚˜ ì´ë™í• ì§€ ê³„ì‚°
      const refractedDx = refractedLength * Math.tan(refractedAngleRad) * (dx1 > 0 ? 1 : -1);
      
      // êµ´ì ˆ ê´‘ì„ ì˜ ëì  ì¢Œí‘œ
      const refractedEndX = intersectionX + refractedDx;
      const refractedEndY = canva.height;

      // ----- ì…ì‚¬ ê´‘ì„  ê·¸ë¦¬ê¸° -----
      drawIncidentRay(lightX, lightY, intersectionX, intersectionY);

      // ----- êµ´ì ˆ ê´‘ì„  ê·¸ë¦¬ê¸° -----
      ctx.strokeStyle = 'rgba(255, 200, 0, 0.8)';  // ì£¼í™©ìƒ‰ (ì•½ê°„ íˆ¬ëª…)
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(intersectionX, intersectionY);    // ì‹œì‘ì  (ê²½ê³„ì„ )
      ctx.lineTo(refractedEndX, refractedEndY);    // ëì 
      ctx.stroke();

      // ----- ë²•ì„ (ìˆ˜ì§ì„ ) ê·¸ë¦¬ê¸° -----
      // ê²½ê³„ì„ ì— ìˆ˜ì§ì¸ ì ì„ 
      ctx.strokeStyle = 'rgba(100, 100, 100, 0.4)';  // íšŒìƒ‰ (ë°˜íˆ¬ëª…)
      ctx.lineWidth = 1;
      ctx.setLineDash([5, 5]);  // ì ì„  íŒ¨í„´
      ctx.beginPath();
      ctx.moveTo(intersectionX, intersectionY - 150);  // ìœ„ìª½ìœ¼ë¡œ
      ctx.lineTo(intersectionX, intersectionY + 150);  // ì•„ë˜ìª½ìœ¼ë¡œ
      ctx.stroke();
      ctx.setLineDash([]);  // ì ì„  íŒ¨í„´ í•´ì œ

      // ----- ì…ì‚¬ê° í‘œì‹œ (í˜¸) -----
      ctx.strokeStyle = 'rgba(255, 100, 100, 0.6)';  // ë¹¨ê°„ìƒ‰
      ctx.lineWidth = 2;
      ctx.beginPath();
      // í˜¸ ê·¸ë¦¬ê¸°: arc(ì¤‘ì‹¬X, ì¤‘ì‹¬Y, ë°˜ì§€ë¦„, ì‹œì‘ê°ë„, ëê°ë„)
      const startAngle1 = -Math.PI / 2;  // ìœ„ìª½ (ë²•ì„ )
      const endAngle1 = -Math.PI / 2 + incidentAngleRad * (dx1 > 0 ? 1 : -1);
      ctx.arc(intersectionX, intersectionY, 40, startAngle1, endAngle1, dx1 < 0);
      ctx.stroke();

      // ----- êµ´ì ˆê° í‘œì‹œ (í˜¸) -----
      ctx.strokeStyle = 'rgba(100, 200, 255, 0.6)';  // íŒŒë€ìƒ‰
      ctx.beginPath();
      const startAngle2 = Math.PI / 2;  // ì•„ë˜ìª½ (ë²•ì„ )
      const endAngle2 = Math.PI / 2 + refractedAngleRad * (dx1 > 0 ? 1 : -1);
      ctx.arc(intersectionX, intersectionY, 50, startAngle2, endAngle2, dx1 < 0);
      ctx.stroke();

      // ----- ê°ë„ í…ìŠ¤íŠ¸ í‘œì‹œ -----
      ctx.fillStyle = '#ff6b6b';  // ë¹¨ê°„ìƒ‰
      ctx.font = 'bold 14px Malgun Gothic';
      ctx.fillText(`Î¸â‚=${incidentAngleDeg}Â°`, intersectionX + 50, intersectionY - 50);
      
      ctx.fillStyle = '#4facfe';  // íŒŒë€ìƒ‰
      ctx.fillText(`Î¸â‚‚=${refractedAngleDeg}Â°`, intersectionX + 60, intersectionY + 70);

      // ----- ì •ë³´ ë°•ìŠ¤ ì—…ë°ì´íŠ¸ -----
      document.getElementById('incidentAngle').textContent = incidentAngleDeg + 'Â°';
      document.getElementById('refractedAngle').textContent = refractedAngleDeg + 'Â°';
    }

    // ===== ì…ì‚¬ ê´‘ì„  ê·¸ë¦¬ê¸° í•¨ìˆ˜ =====
    function drawIncidentRay(startX, startY, endX, endY) {
      ctx.strokeStyle = 'rgba(255, 50, 50, 0.8)';  // ë¹¨ê°„ìƒ‰
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(startX, startY);  // ê´‘ì›
      ctx.lineTo(endX, endY);      // ê²½ê³„ì„  êµì 
      ctx.stroke();
    }

    // ===== ê´‘ì›(ë§ˆìš°ìŠ¤) ê·¸ë¦¬ê¸° í•¨ìˆ˜ =====
    function drawLightSource(x, y) {
      // ë¹›ë‚˜ëŠ” íš¨ê³¼ë¥¼ ìœ„í•œ ê·¸ë¼ë°ì´ì…˜
      const gradient = ctx.createRadialGradient(x, y, 0, x, y, 30);
      gradient.addColorStop(0, 'rgba(255, 255, 100, 1)');    // ì¤‘ì‹¬: ë°ì€ ë…¸ë€ìƒ‰
      gradient.addColorStop(0.5, 'rgba(255, 200, 0, 0.6)');  // ì¤‘ê°„: ì£¼í™©ìƒ‰
      gradient.addColorStop(1, 'rgba(255, 200, 0, 0)');      // ê°€ì¥ìë¦¬: íˆ¬ëª…

      // ë¹› íš¨ê³¼ ê·¸ë¦¬ê¸°
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(x, y, 30, 0, Math.PI * 2);  // ì› ê·¸ë¦¬ê¸°
      ctx.fill();

      // ê´‘ì› ì¤‘ì‹¬ì  (ì‘ì€ ì›)
      ctx.fillStyle = '#ffff00';  // ë…¸ë€ìƒ‰
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, Math.PI * 2);
      ctx.fill();

      // ê´‘ì› í…Œë‘ë¦¬
      ctx.strokeStyle = '#ff9900';  // ì£¼í™©ìƒ‰
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    // ===== í™”ë©´ í¬ê¸° ë³€ê²½ ì´ë²¤íŠ¸ =====
    // ë¸Œë¼ìš°ì € ì°½ í¬ê¸°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰
    window.addEventListener('resize', () => {
      canva.width = window.innerWidth;   // ë„ˆë¹„ ì¬ì¡°ì •
      canva.height = window.innerHeight; // ë†’ì´ ì¬ì¡°ì •
      draw();  // í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    });

    // ===== ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸° =====
    draw();
  </script>
</body>
</html>
